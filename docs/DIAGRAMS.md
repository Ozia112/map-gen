# ๐ Diagramas del Sistema

> Diagramas de flujo y UML del Generador de Mapas Topogrรกficos 3D

---

## 1. Diagrama de Flujo - Generaciรณn de Terreno e Interacciรณn con UI

Este diagrama muestra el flujo completo desde el inicio de la aplicaciรณn, pasando por la generaciรณn de terreno, hasta la interacciรณn en tiempo real con el usuario.

### Inicio y Generaciรณn Inicial

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    INICIO DE LA APLICACIรN                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ   run.py        โ
                    โ (Launcher)      โ
                    โโโโโโโโโโฌโโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ   main.py       โ
                    โโโโโโโโโโฌโโโโโโโโโ
                             โ
        โโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโ
        โ                    โ                    โ
        โผ                    โผ                    โผ
  โโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ
  โ MapModel โ       โMapController โ     โWebViewControllerโ
  โโโโโโฌโโโโโโ       โโโโโโโโฌโโโโโโโโ     โโโโโโโโฌโโโโโโโโ
       โ                    โ                     โ
       โผ                    โ                     โ
โโโโโโโโโโโโโโโโโโ          โ                     โ
โTerrainGeneratorโ          โ                     โ
โโโโโโโโโโโโโโโโโโ          โ                     โ
```

### Pipeline de Generaciรณn de Terreno

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   GENERACIรN DE TERRENO                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. SELECCIรN DE BACKEND
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Resoluciรณn < 160k pรญxeles?        โ
   โโโโโโโโโฌโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโ
           โ Sรญ            โ No
           โผ               โผ
    โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
    โ Perlin 3D   โ  โ fBm         โ
    โ (Preciso)   โ  โ (Rรกpido)    โ
    โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ
           โโโโโโโโโโฌโโโโโโโโโ
                    โผ

2. GENERACIรN DE RUIDO BASE
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Parรกmetros:                    โ
   โ โข scale = f(roughness)         โ
   โ โข octaves = f(roughness)       โ
   โ โข persistence = f(roughness)   โ
   โ โข seed (normalizado)           โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Numpy Array [width x height]  โ
   โ Valores: [-1.0, 1.0]           โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ
3. ESCALADO POR ALTURA
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ terrain *= height_variation    โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ

4. SUAVIZADO GAUSSIANO
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ gaussian_filter(terrain, ฯ=0.8)โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ

5. NORMALIZACIรN
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ terrain -= terrain.min()       โ
   โ (Base en 0)                    โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ

6. CRรTERES (Si estรกn activados)
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ For crater in num_craters:     โ
   โ   โข Centro hundido             โ
   โ   โข Transiciรณn suave           โ
   โ   โข Rim elevado                โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ

7. ALTURA BASE "PASTEL"
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ terrain += BASE_HEIGHT (2.0)   โ
   โ (Siempre visible)              โ
   โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                   โผ
           โโโโโโโโโโโโโโโโโ
           โ   HEIGHTMAP   โ
           โ   COMPLETO    โ
           โโโโโโโโโโโโโโโโโ
```

### Renderizado de Preview

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      RENDERIZADO                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

HEIGHTMAP โ RenderController.render_preview()
                    โ
                    โผ
            โโโโโโโโโโโโโโโโโ
            โ visualization โ
            โ .export_      โ
            โ preview_image โ
            โโโโโโโโโฌโโโโโโโโ
                    โ
    โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
    โ               โ               โ
    โผ               โผ               โผ
โโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
โ Compute โ  โ   Draw      โ  โ   Draw      โ
โ Levels  โโ โ  Contours   โโ โ  Supports   โ
โ(30)     โ  โ  (3D Lines) โ  โ  & Grid     โ
โโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
                    โ
                    โผ
            โโโโโโโโโโโโโโโโ
            โ preview.png  โ
            โ (web/tmp/)   โ
            โโโโโโโโโโโโโโโโ
```

### Interacciรณn en Tiempo Real

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           ACTUALIZACIรN EN TIEMPO REAL (Usuario)                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

USUARIO mueve slider
        โ
        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโ
โ app.js                โ
โ โข Captura evento      โ
โ โข Actualiza estado    โ
โ โข Debounce (300ms)    โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโ
           โ
           โ eel.api_update(params)
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ WebViewController            โ
โ @eel.expose api_update()     โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MapController                โ
โ .handle_update()             โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MapModel                     โ
โ โข update_*_params()          โ
โ โข Validaciรณn de parรกmetros   โ
โ โข generate()                 โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NUEVO HEIGHTMAP              โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ RenderController             โ
โ .render_preview()            โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NUEVO preview.png            โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โ return {'ok': true}
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ app.js                       โ
โ โข Actualiza <img>            โ
โ โข showLoader(false)          โ
โ โข Usuario ve nuevo mapa      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

TIEMPO TOTAL: ~500ms - 2s
(Depende de resoluciรณn y parรกmetros)
```

### Exportaciรณn de Alta Calidad

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EXPORTACIรN HD                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

USUARIO click "Guardar PNG/SVG"
        โ
        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโ
โ app.js                โ
โ els.btnExport.onclick โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโ
           โ
           โ eel.api_export({format, filename})
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ WebViewController            โ
โ @eel.expose api_export()     โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MapController                โ
โ .handle_export()             โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ RenderController             โ
โ .export_map()                โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ visualization                โ
โ .export_map_clean()          โ
โ โข Sin UI                     โ
โ โข Alta resoluciรณn (300 DPI)  โ
โ โข Respeta vista actual       โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ./generados/                 โ
โ map_YYYYMMDD_HHMMSS.png      โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
           โ
           โ return {'ok': true, 'path': '...'}
           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ showToast('โ Guardado')      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 2. Diagrama de Clases UML

### Vista General del Sistema

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ARQUITECTURA MVC                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โ   MODEL     โ         โ  CONTROLLER  โ         โ     VIEW     โ
โ             โโโโโโโโโโโ              โโโโโโโโโโโ              โ
โ  MapModel   โ  uses   โMapController โ updates โWebViewControllerโ
โ             โ         โ              โ         โ              โ
โโโโโโโโฌโโโโโโโ         โโโโโโโโฌโโโโโโโโ         โโโโโโโโฌโโโโโโโโ
       โ                       โ                        โ
       โ contains              โ uses                   โ serves
       โผ                       โผ                        โผ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โ  Terrain    โ         โ  Render      โ         โ  Web         โ
โ  Generator  โ         โ  Controller  โ         โ  Interface   โ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
```

### Clases Principales

#### MapModel (Modelo)

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      <<Model>>                              โ
โ                      MapModel                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ATRIBUTOS                                                   โ
โ - terrain_params: Dict[str, Any]                            โ
โ   ยท height_variation: float (0-20)                          โ
โ   ยท terrain_roughness: int (0-100)                          โ
โ   ยท seed: int (1-10000000)                                  โ
โ                                                             โ
โ - visual_params: Dict[str, Any]                             โ
โ   ยท num_contour_levels: int (10-40)                         โ
โ   ยท azimuth_angle: float (0-360)                            โ
โ   ยท elevation_angle: float (0-90)                           โ
โ   ยท line_color: str                                         โ
โ   ยท show_axis_labels: bool                                  โ
โ   ยท grid_color, grid_width, grid_opacity                    โ
โ                                                             โ
โ - crater_params: Dict[str, Any]                             โ
โ   ยท enabled: bool                                           โ
โ   ยท density: int (0-10)                                     โ
โ   ยท size: float (0.1-1.0)                                   โ
โ   ยท depth: float (0.1-1.0)                                  โ
โ                                                             โ
โ - _generator: TopographicMapGenerator                       โ
โ - _last_heightmap: Optional[np.ndarray]                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ MรTODOS PรBLICOS                                            โ
โ + __init__(width: int, height: int)                         โ
โ + generator @property                                       โ
โ + heightmap @property                                       โ
โ + update_terrain_params(**kwargs) : Dict                    โ
โ + update_visual_params(**kwargs) : Dict                     โ
โ + update_crater_params(**kwargs) : Dict                     โ
โ + generate() : np.ndarray                                   โ
โ + get_all_params() : Dict                                   โ
โ + random_seed() : int                                       โ
โ                                                             โ
โ MรTODOS PRIVADOS                                            โ
โ - _validate_terrain_params(params) : Dict                   โ
โ - _validate_visual_params(params) : Dict                    โ
โ - _validate_crater_params(params) : Dict                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### TopographicMapGenerator

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    <<Generator>>                            โ
โ              TopographicMapGenerator                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ATRIBUTOS                                                   โ
โ + width: int                                                โ
โ + height: int                                               โ
โ + terrain: Optional[np.ndarray]                             โ
โ + fig: Optional[Figure]                                     โ
โ + ax: Optional[Axes3D]                                      โ
โ + last_backend: Optional[str]  # 'perlin' o 'fbm'           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ MรTODOS PรBLICOS                                            โ
โ + __init__(width: int, height: int)                         โ
โ + generate_terrain(                                         โ
โ     terrain_roughness: int,                                 โ
โ     height_variation: float,                                โ
โ     seed: int,                                              โ
โ     crater_enabled: bool,                                   โ
โ     num_craters: int,                                       โ
โ     crater_size: float,                                     โ
โ     crater_depth: float,                                    โ
โ     base_height: float = 20.0                               โ
โ   ) : None                                                  โ
โ                                                             โ
โ MรTODOS PRIVADOS                                            โ
โ - _generate_fbm_terrain(...) : np.ndarray                   โ
โ   ยท Fractal Brownian Motion vectorizado                     โ
โ   ยท Mรบltiples octavas                                       โ
โ   ยท Rรกpido para resoluciones altas                          โ
โ                                                             โ
โ - _apply_craters_visible(...) : None                        โ
โ   ยท Crea crรกteres realistas                                 โ
โ   ยท Centro hundido + rim elevado                            โ
โ   ยท Transiciรณn suave                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### MapController (Controlador Principal)

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    <<Controller>>                           โ
โ                   MapController                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ATRIBUTOS                                                   โ
โ + model: MapModel                                           โ
โ + render_controller: RenderController                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ MรTODOS                                                     โ
โ + __init__(model: MapModel)                                 โ
โ                                                             โ
โ # Gestiรณn de parรกmetros                                     โ
โ + handle_update(params: Dict) : Dict[str, Any]              โ
โ + handle_terrain_update(**kwargs) : Dict                    โ
โ + handle_visual_update(**kwargs) : Dict                     โ
โ + handle_crater_update(**kwargs) : Dict                     โ
โ                                                             โ
โ # Rotaciรณn de vista                                         โ
โ + handle_rotation(azimuth, elevation) : Dict                โ
โ + handle_reset_rotation() : Dict                            โ
โ                                                             โ
โ # Inicializaciรณn y estado                                   โ
โ + initialize_map() : Dict                                   โ
โ + get_current_state() : Dict                                โ
โ + handle_random_seed() : Dict                               โ
โ                                                             โ
โ # Exportaciรณn                                               โ
โ + handle_export(export_params: Dict) : Dict                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### RenderController

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    <<Controller>>                           โ
โ                   RenderController                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ATRIBUTOS                                                   โ
โ (Stateless - sin atributos de instancia)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ MรTODOS                                                     โ
โ + render_preview(                                           โ
โ     generator: TopographicMapGenerator,                     โ
โ     visual_params: Dict,                                    โ
โ     path: str                                               โ
โ   ) : bool                                                  โ
โ   ยท Genera preview rรกpido para UI web                       โ
โ                                                             โ
โ + export_map(                                               โ
โ     generator: TopographicMapGenerator,                     โ
โ     visual_params: Dict,                                    โ
โ     format: str,                                            โ
โ     path: str                                               โ
โ   ) : bool                                                  โ
โ   ยท Exporta mapa de alta calidad                            โ
โ                                                             โ
โ + export_with_dialog(                                       โ
โ     generator: TopographicMapGenerator,                     โ
โ     visual_params: Dict,                                    โ
โ     format: str                                             โ
โ   ) : Optional[str]                                         โ
โ   ยท Muestra diรกlogo de guardado                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### WebViewController (Vista - Adaptador)

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 <<View Controller>>                         โ
โ                 WebViewController                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ATRIBUTOS                                                   โ
โ + map_controller: MapController                             โ
โ + web_dir: str                                              โ
โ + preview_dir: str                                          โ
โ + preview_path: str                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ MรTODOS PRINCIPALES                                         โ
โ + __init__(map_controller, web_dir, preview_dir)            โ
โ + setup_eel_routes() : None                                 โ
โ + setup_http_routes() : None                                โ
โ + start_server(host, port, mode, ...) : None                โ
โ                                                             โ
โ MรTODOS PRIVADOS                                            โ
โ - _cleanup_old_files(keep_files) : None                     โ
โ - _generate_preview() : None                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ENDPOINTS EEL (@eel.expose)                                 โ
โ + api_get_state() : Dict                                    โ
โ   ยท Retorna estado actual del modelo                        โ
โ                                                             โ
โ + api_update(params: Dict) : Dict                           โ
โ   ยท Actualiza parรกmetros y regenera                         โ
โ                                                             โ
โ + api_rotate(azimuth, elevation) : Dict                     โ
โ   ยท Rota la vista sin regenerar terreno                     โ
โ                                                             โ
โ + api_reset_rotation() : Dict                               โ
โ   ยท Resetea รกngulos a valores por defecto                   โ
โ                                                             โ
โ + api_export(format, filename) : Dict                       โ
โ   ยท Exporta mapa a archivo                                  โ
โ                                                             โ
โ + api_random_seed() : Dict                                  โ
โ   ยท Genera semilla aleatoria                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Diagrama de Relaciones

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  RELACIONES ENTRE CLASES                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

     MapModel โโโโโโโโusesโโโโโโโ TopographicMapGenerator
        โ                                   
        โ                                   
        โ orchestrates                      
        โผ                                   
  MapController โโโโโโusesโโโโโโโ RenderController
        โ                              โ
        โ                              โ
        โ                              โ uses
        โ                              โผ
        โ                        visualization
        โ                          (module)
        โ
        โ delegates
        โผ
 WebViewController โโโโโโservesโโโโโโโ Web Interface
        โ                              (HTML/CSS/JS)
        โ
        โ exposes via Eel
        โผ
   @eel.expose endpoints
   (API Bridge JS โ Python)
```

### Principios de Diseรฑo Aplicados

```ascii
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 PRINCIPIOS SOLID                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ S - Single Responsibility Principle
   ยท MapModel: SOLO gestiรณn de estado
   ยท MapController: SOLO orquestaciรณn
   ยท RenderController: SOLO renderizado
   ยท WebViewController: SOLO adaptaciรณn web

โ O - Open/Closed Principle
   ยท Fรกcil agregar nuevos backends de ruido
   ยท Fรกcil agregar nuevos formatos de exportaciรณn
   ยท Sin modificar cรณdigo existente

โ L - Liskov Substitution
   ยท (No hay herencia en la arquitectura actual)

โ I - Interface Segregation
   ยท Cada controlador expone solo mรฉtodos relevantes
   ยท No hay interfaces "gordas"

โ D - Dependency Inversion
   ยท Controller depende de Model (abstracciรณn)
   ยท View depende de Controller (abstracciรณn)
   ยท Las dependencias fluyen hacia las abstracciones

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              PATRONES DE DISEรO                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ MVC (Model-View-Controller)
   ยท Separaciรณn clara de responsabilidades
   ยท Vista independiente del modelo
   ยท Controlador como orquestador

โ Facade Pattern
   ยท MapController como fachada para operaciones complejas
   ยท Simplifica interacciรณn entre componentes

โ Strategy Pattern
   ยท Selecciรณn dinรกmica de backend (Perlin vs fBm)
   ยท Basado en resoluciรณn

โ Singleton-like (Module Pattern)
   ยท visualization como mรณdulo con funciones stateless
   ยท _meshgrid_cache para optimizaciรณn
```

---

## Resumen de Flujos Principales

### 1. Generaciรณn Inicial

```ascii
run.py โ main.py โ MapModel โ TerrainGenerator โ Heightmap
    โ RenderController โ preview.png โ WebViewController โ Browser
```

### 2. Actualizaciรณn de Parรกmetros

```ascii
User โ app.js โ eel.api_update() โ WebViewController โ MapController
    โ MapModel โ validate โ generate โ RenderController โ preview.png
    โ return JSON โ app.js โ update <img>
```

### 3. Rotaciรณn de Vista

```ascii
User โ app.js โ eel.api_rotate() โ WebViewController โ MapController
    โ MapModel.update_visual_params() โ RenderController โ preview.png
    โ return JSON โ app.js โ update <img>
```

### 4. Exportaciรณn

```ascii
User โ app.js โ eel.api_export() โ WebViewController โ MapController
    โ RenderController.export_map() โ visualization.export_map_clean()
    โ save to ./generados/ โ return JSON โ app.js โ showToast()
```

---

**รltima actualizaciรณn**: Octubre 18, 2025
